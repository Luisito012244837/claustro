<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Nuevo Trabajador - Akademia</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    
    <link rel="stylesheet" href="assets/css/estilo opciones.css">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #d8d2d6;
            border-color: #5f5b5b;
            color: rgb(100, 95, 95);
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
        }

        select {
    background-color: rgb(240, 234, 234); /* Fondo del select */
    color: black; /* Color del texto */
    padding: 5px;
    border: 1px solid #0cde4b;
    border-radius: 4px;
}

/* Estilos para los option */
select option {
    
    color: black; /* Color del texto */
    background-color: rgb(237, 241, 238); /* Fondo del option */
}

/* Estilos para Select2 */
.select2-container--default .select2-selection--multiple .select2-selection__choice {
    color: rgb(14, 1, 1); /* Color del texto seleccionado */
    background-color: #e9ecef; /* Fondo de los elementos seleccionados */
}

.select2-container--default .select2-results__option {
    color: black; /* Color del texto en la lista desplegable */
    background-color: white; /* Fondo de los elementos en la lista desplegable */
}

.select2-container--default .select2-results__option--highlighted {
    color: rgb(17, 12, 12); /* Color del texto cuando se resalta */
    background-color: #007bff; /* Fondo cuando se resalta */
}
    </style>
</head>

<body id="page-top">
    <div id="wrapper">
        <!-- Barra lateral -->
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-success p-0">
            <div class="container-fluid d-flex flex-column p-0">
                <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-text mx-3 text color"><span>AKADEMIA</span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="fas fa-tachometer-alt"></i><span>Bienvenido</span></a></li>
                    <li class="nav-item"><a class="nav-link active" href="control.html"><i class="fas fa-user-circle"></i><b><span> Control </span></b></a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html"><i class="far fa-user-circle"></i><span>Login</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="register.html"><i class="fas fa-user-circle"></i><span>Registrar</span></a></li>
                </ul>
                <div class="text-center d-none d-md-inline">
                    <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
                </div>
            </div>
        </nav>

        <!-- Contenido principal -->
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <!-- Barra de navegación superior -->
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid">
                        <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow">
                                    <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#">
                                        <span class="d-none d-lg-inline me-2 text-gray-600 small">Valerie Luna</span>
                                        <!--<img class="border rounded-circle img-profile" src="assets/img/avatars/avatar1.jpeg"> -->
                                    </a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in">
                                        <a class="dropdown-item" href="#"><i class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Perfil</a>
                                        <a class="dropdown-item" href="#"><i class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Configuración</a>
                                        <a class="dropdown-item" href="#"><i class="fas fa-list fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Registro de actividad</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Cerrar sesión</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Formulario de nuevo perfil -->
                <div class="container-fluid">
                    <h3 style="color: rgb(27, 22, 22);">Nuevo Trabajador</h3>
                    <div class="row mb-3">
                        <div class="col-lg-14">
                            <div class="card shadow mb-3 fade-in">
                                <div class="card-header py-3">
                                    <p class="m-0 fw-bold" style="text-align: left;color: black;">Añadir nuevo trabajador</p>
                                </div>
                                <div class="card-body">
                                    <form id="trabajadorForm">
                                        <!-- Campos del formulario -->
                                        <div class="row">
                                            <!-- Primera fila de 4 campos -->
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="username" style="color: rgb(27, 22, 22);"><strong>Nombre</strong></label>
                                                    <input class="form-control" type="text" id="username" placeholder="Nombre" name="username" required>
                                                    <div class="invalid-feedback">Por favor, ingresa un nombre válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="primerApellido" style="color: rgb(27, 22, 22);"><strong>Primer Apellido</strong></label>
                                                    <input class="form-control" type="text" id="primerApellido" placeholder="Primer Apellido" name="primerApellido" required>
                                                    <div class="invalid-feedback">Por favor, ingresa un apellido válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="segundoApellido" style="color: rgb(27, 22, 22);"><strong>Segundo Apellido</strong></label>
                                                    <input class="form-control" type="text" id="segundoApellido" placeholder="Segundo Apellido" name="segundoApellido" required>
                                                    <div class="invalid-feedback">Por favor, ingresa un apellido válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="group_count" style="color: rgb(27, 22, 22);"><strong>Cant_Grup_Conferencia</strong></label>
                                                    <input class="form-control" type="number" id="group_count" placeholder="cantidad de grupos" name="group_count" required min="1" max="9">
                                                    <div class="invalid-feedback">Por favor, ingresa un número válido menor que 10.</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Segunda fila de 4 campos -->
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="group_count_practica" style="color: rgb(27, 22, 22);"><strong>Cant_Grup_Clase_Práctica</strong></label>
                                                    <input class="form-control" type="number" id="group_count_practica" placeholder="cantidad de grupos" name="group_count_practica" required min="1" max="9">
                                                    <div class="invalid-feedback">Por favor, ingresa un número válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="year_graduated" style="color: rgb(27, 22, 22);"><strong>Año Graduado</strong></label>
                                                    <input class="form-control" type="number" id="year_graduated" placeholder="Ingrese año" name="year_graduated" required>
                                                    <div class="invalid-feedback">Por favor, ingresa un año de graduación válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="experience_years" style="color: rgb(27, 22, 22);"><strong>Años de experiencia</strong></label>
                                                    <input class="form-control" type="number" id="experience_years" placeholder="Años de experiencia" name="experience_years" required>
                                                    <div class="invalid-feedback">Por favor, ingresa un valor válido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="sexo" style="color: rgb(27, 22, 22);"><strong>Sexo</strong></label>
                                                    <select class="form-control" id="sexo" name="sexo" required>
                                                        <option value="" selected disabled hidden>Género</option>
                                                        <option value="Masculino">Masculino</option>
                                                        <option value="Femenino">Femenino</option>
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona un sexo.</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Tercera fila de 4 campos -->
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="course" style="color: rgb(27, 22, 22);"><strong>Curso que imparte</strong></label>
                                                    <select class="form-control select2" id="course" name="course"  multiple="multiple" style="background-color: black;" required>
                                                     
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona un curso.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="categoriaDocente" style="color: rgb(27, 22, 22);"><strong>Categoría Docente</strong></label>
                                                    <select class="form-control select2" id="categoriaDocente" name="categoriaDocente" multiple="multiple" required>
                                                       
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona al menos una categoría.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="anioAcademico" style="color: rgb(27, 22, 22);"><strong>Año Académico</strong></label>
                                                    <select class="form-control select2" id="anioAcademico" name="anioAcademico" multiple="multiple" required>
                                                       
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona al menos un año académico.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="career" style="color: rgb(27, 22, 22);"><strong>Carrera</strong></label>
                                                    <select class="form-control select2" id="career" name="career" multiple="multiple" required>
                                                        
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona al menos una carrera.</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Cuarta fila de 4 campos -->
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="responsabilidad" style="color: rgb(27, 22, 22);"><strong>Responsabilidad</strong></label>
                                                    <select class="form-control select2" id="responsabilidad" name="responsabilidad" multiple="multiple" required>
                                                    
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona al menos una responsabilidad.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="cargo" style="color: rgb(27, 22, 22);"><strong>Cargo</strong></label>
                                                    <select class="form-control select2" id="cargo" name="cargo" multiple="multiple" required>
                                                       
                                                    </select>
                                                    <div class="invalid-feedback">Por favor, selecciona al menos un cargo.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="mb-3">
                                                    <label class="form-label" for="categoriaCientifica" style="color: rgb(27, 22, 22);">
                                                        <strong>Categoría Científica</strong>
                                                    </label>
                                                    <select class="form-control select2" id="categoriaCientifica" name="categoriaCientifica" required>
                                                        <option value="" selected disabled hidden>Seleccione una categoría</option>
                                                        <!-- Las opciones se cargarán dinámicamente -->
                                                    </select>
                                                   <div class="invalid-feedback">Por favor, selecciona una categoría científica.</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Áreas y asignaturas -->
                                        <div class="row">
                                            <div class="col-md-5">
                                                <div class="card shadow-sm mb-4">
                                                    <div class="card-header bg-light py-3">
                                                        <h6 class="mb-0 toggle-button" style="color: rgb(27, 22, 22);">
                                                            Asignatura:
                                                        </h6>
                                                    </div>
                                                    <div class="card-body p-3">
                                                        <!-- Select con múltiples opciones -->
                                                        <select class="form-control select2" id="asignaturaList" name="asignaturaList" multiple="multiple" required>
                                                        </select>
                                                        <div class="invalid-feedback">Por favor, selecciona al menos una asignatura.</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card shadow-sm mb-4">
                                                    <div class="card-header bg-light py-3">
                                                        <h6 class="mb-0 toggle-button" style="color: rgb(27, 22, 22);">
                                                          Área:
                                                        </h6>
                                                    </div>
                                                    <div class="card-body p-3">
                                                        <!-- Select con múltiples opciones -->
                                                        <select class="form-control select2" id="areaList" name="areaList" multiple="multiple" required>
                                                        </select>
                                                        <div class="invalid-feedback">Por favor, selecciona al menos un área.</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Botón de guardar -->
                                        <div class="text-center mb-3">
                                            <button class="btn btn-primary btn-sm" type="submit">Guardar cambios</button>
                                           
                                            <button class="btn btn-danger btn-sm" type="button" onclick="window.location.href='index.html'">Cancelar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pie de página -->
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright © UCI 2025</span></div>
                </div>
            </footer>
        </div>
        <a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>

    <!-- Scripts -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/js.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/funcionrelleno.js"></script>
    <script>
        // Inicializar Select2 con checkboxes
        $(document).ready(function () {
            // Configurar Select2 para todos los campos múltiples
            $('.select2').select2({
                placeholder: "Seleccionar", // Placeholder
                closeOnSelect: false, // No cerrar el dropdown al seleccionar una opción
                allowClear: true, // Permitir borrar selecciones
            });
    
            // Configurar Select2 para el campo de Categoría Científica (solo una selección)
            $('#categoriaCientifica').select2({
                placeholder: "Seleccione una categoría", // Placeholder
                allowClear: true, // Permitir borrar la selección
                maximumSelectionLength: 1, // Solo permitir una selección
            });
        });
    
        // Capturar el formulario
        const trabajadorForm = document.getElementById('trabajadorForm');
    
        // Escuchar el evento submit del formulario
        trabajadorForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Evitar el envío tradicional
    
            // Obtener los valores del formulario
            const nombre = document.getElementById('username').value;
            const primerApellido = document.getElementById('primerApellido').value;
            const segundoApellido = document.getElementById('segundoApellido').value;
            const cantidadGruposConferencia = document.getElementById('group_count').value;
            const cantidadGruposPractica = document.getElementById('group_count_practica').value;
            const añoGraduado = document.getElementById('year_graduated').value;
            const añosExperiencia = document.getElementById('experience_years').value;
            const sexo = document.getElementById('sexo').value;
            const curso = $('#course').val(); // Usar Select2
            const categoriaDocente = $('#categoriaDocente').val(); // Usar Select2
            const anioAcademico = $('#anioAcademico').val(); // Usar Select2
            const carrera = $('#career').val(); // Usar Select2
            const responsabilidad = $('#responsabilidad').val(); // Usar Select2
            const cargo = $('#cargo').val(); // Usar Select2
            const categoriaCientifica = $('#categoriaCientifica').val(); // Obtener la categoría científica seleccionada
            const asignaturas = $('#asignaturaList').val(); // Usar Select2
            const areas = $('#areaList').val(); // Usar Select2
    
            // Validar que al menos un curso esté seleccionado
            if (!curso || curso.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Por favor, selecciona al menos un curso.',
                });
                return; // Detener el envío si no se selecciona un curso
            }
    
            // Validar que se haya seleccionado una categoría científica
            if (!categoriaCientifica || categoriaCientifica === '') {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Por favor, selecciona una categoría científica.',
                });
                return; // Detener el envío si no se selecciona una categoría
            }
    
            // Validar que solo se haya seleccionado una opción en Categoría Científica
            if (Array.isArray(categoriaCientifica) && categoriaCientifica.length > 1) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Solo puedes seleccionar una categoría científica.',
                });
                return; // Detener el envío si se selecciona más de una opción
            }
    
            // Validar campos obligatorios
            if (!nombre || !primerApellido || !segundoApellido || !cantidadGruposConferencia ||
                !cantidadGruposPractica || !añoGraduado || !añosExperiencia || !sexo || !curso ||
                !categoriaDocente || !anioAcademico || !carrera || !responsabilidad || !cargo ||
                !categoriaCientifica || !asignaturas || !areas) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Por favor, completa todos los campos obligatorios.',
                });
                return; // Detener el envío si hay errores
            }
    
            // Datos para enviar a la API
            const data = {
                nombre: nombre,
                primer_apellido: primerApellido,
                segundo_apellido: segundoApellido,
                cantidad_grupo_c: cantidadGruposConferencia,
                cantidad_grupo_cp: cantidadGruposPractica,
                ano_graduado: añoGraduado,
                anos_experiencia: añosExperiencia,
                sexo: sexo,
                nombre_categoria_cientifica: categoriaCientifica,
                nombre_categoria_docente: Array.isArray(categoriaDocente) ? categoriaDocente : [categoriaDocente], // Asegurar que sea una lista
                nombre_curso: Array.isArray(curso) ? curso : [curso], // Asegurar que sea una lista
                anno_academico: Array.isArray(anioAcademico) ? anioAcademico : [anioAcademico], // Asegurar que sea una lista
                nombre_carrera: Array.isArray(carrera) ? carrera : [carrera], // Asegurar que sea una lista
                nombre_responsabilidad: Array.isArray(responsabilidad) ? responsabilidad : [responsabilidad], // Asegurar que sea una lista
                nombre_cargo: Array.isArray(cargo) ? cargo : [cargo], // Asegurar que sea una lista
                nombre_asignatura: Array.isArray(asignaturas) ? asignaturas : [asignaturas], // Asegurar que sea una lista
                nombre_area: Array.isArray(areas) ? areas : [areas], // Asegurar que sea una lista
            };
    
            try {
                // Hacer la solicitud POST a la API
                const response = await fetch('http://192.168.138.176:8000/apiv2/insertTrabajador/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
    
                // Verificar si la respuesta es exitosa
                if (response.ok) {
                    const result = await response.json();
                    console.log('Respuesta de la API:', result);
    
                    // Mostrar mensaje de éxito con SweetAlert2
                    Swal.fire({
                        icon: 'success',
                        title: '¡Trabajador registrado!',
                        text: 'El trabajador ha sido registrado correctamente.',
                    }).then(() => {
                        // Redirigir al usuario después del registro
                        window.location.href = '/control.html'; // Cambia la URL según tu aplicación
                    });
                } else {
                    // Manejar errores de la API
                    const errorData = await response.json();
                    console.error('Error en la API:', errorData);
    
                    // Mostrar mensaje de error con SweetAlert2
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: errorData.message || 'Hubo un problema al registrar el trabajador.',
                    });
                }
            } catch (error) {
                console.error('Error en la solicitud:', error);
    
                // Mostrar mensaje de error en caso de fallo en la conexión
                Swal.fire({
                    icon: 'error',
                    title: 'Error de conexión',
                    text: 'No se pudo conectar al servidor. Inténtalo de nuevo más tarde.',
                });
            }
        });
    </script>
</body>

</html>